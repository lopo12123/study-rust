## Cargo

> `cargo new`

**æ–°å»ºé¡¹ç›®** `cargo new project_name`

- é¡¹ç›®ç»“æ„:

```yaml
project_name
- src
  - main.rs
- .gitignore
- Cargo.toml
- Cargo.lock
```

> `cargo build`

**æ„å»ºé¡¹ç›®** `cargo build`

- åœ¨ç›®æ ‡è·¯å¾„ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶.
- è·¯å¾„: `target/debug/project_name.exe` \(windows\)

**ä¸ºå‘å¸ƒæ„å»º** `cargo build --release`

- ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¼˜åŒ–, ä»£ç ä¼šè¿è¡Œçš„æ›´å¿«, ä½†ç¼–è¯‘æ—¶é—´æ›´é•¿.
- ä¼šåœ¨ `target/release` ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶, è€Œä¸æ˜¯ `target/debug`

> `cargo run`

**æ„å»ºå¹¶è¿è¡Œé¡¹ç›®** `cargo run`

- å¦‚æœé¡¹ç›®ç¼–è¯‘è¿‡ä½†æœªä¿®æ”¹, åˆ™ä¼šç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶, ä¸ä¼šé‡å¤ç¼–è¯‘.

> `cargo check`

**æ£€æŸ¥ä»£ç ** `cargo check`

- æ£€æŸ¥ä»£ç , ç¡®ä¿èƒ½é€šè¿‡ç¼–è¯‘, ä½†ä¸ä¼šäº§ç”Ÿä»»ä½•å¯æ‰§è¡Œæ–‡ä»¶.
- `cargo check` æ¯” `cargo build` å¿«å¾—å¤š, èƒ½è¿ç»­åå¤çš„ä½¿ç”¨ `cargo check` æ£€æŸ¥ä»£ç , æé«˜æ•ˆç‡.

> `Cargo.toml` _Tom`s Obvious, Minimal Language_

Cargoé¡¹ç›®çš„é…ç½®æ–‡ä»¶æ ¼å¼

- å¸¸è§å­—æ®µå«ä¹‰:

```toml
### åŒ…é…ç½®ä¿¡æ¯
[package]

# é¡¹ç›®å
name = "study-rust"

# é¡¹ç›®ç‰ˆæœ¬
version = "0.1.0"

# ä½¿ç”¨çš„rustç‰ˆæœ¬
edition = "2021"

# è½¯ä»¶åŒ…çš„è®¸å¯è¯
license = "MIT"

# ä½œè€…
authors = ["lopo <lopo@zju.edu.cn>"]

# å¯¹åŒ…çš„ç®€è¦ä»‹ç»è¯´æ˜
description = "a brief description of this package"

# æ˜¾å¼å£°æ˜å“ªäº›æ–‡ä»¶è¢«åŒ…å«(æ’é™¤)åœ¨å†…(å¤–)
exclude = ["build/**/*.o", "doc/**/*.html"]
include = ["src/**/*", "Cargo.toml"]

# æ›´å¤šä¿¡æ¯ (url)
documentation = "..."
homepage = "..."
repository = "..."

# æŒ‡å‘READMEæ–‡ä»¶, å¹¶ä¼šè¢«ä¿å­˜åœ¨æ³¨å†Œè¡¨æ•°æ®åº“ä¸­
readme = "..."

### ä¾èµ–ä¿¡æ¯
[dependencies]

# æŒ‡å®šåŒ…çš„ç‰ˆæœ¬
hammer = "0.5.0"

# æŒ‡å®šåŒ…çš„ç‰ˆæœ¬èŒƒå›´
color = "> 0.6.0, < 0.8.0"
```

## Rust

### å˜é‡

> **å˜é‡ä¸å¯å˜æ€§**

- å£°æ˜å˜é‡ä½¿ç”¨ `let` å…³é”®å­—
- é»˜è®¤æƒ…å†µä¸‹å˜é‡æ˜¯ä¸å¯å˜(_immutable_)çš„
- å£°æ˜å˜é‡æ—¶åœ¨å˜é‡å‰åŠ ä¸Š `mut`, ä½¿å˜é‡å¯å˜

```rust
fn mut_and_immut() {
    let immut_variable = 1;
    let mut mut_variable = 1;
    // immut_variable = 2;  // panic
    mut_variable = 2;  // correct
}
```

> **å˜é‡ä¸å¸¸é‡**

- å¸¸é‡(_constant_)åœ¨ç»‘å®šå€¼åä¹Ÿæ˜¯ä¸å¯å˜çš„, ä½†å®ƒä¸ä¸å¯å˜å˜é‡æœ‰å¾ˆå¤šåŒºåˆ«:
    - ä¸å¯ä»¥ä½¿ç”¨ `mut`, å¸¸é‡æ˜¯æ°¸è¿œä¸å¯å˜çš„
    - å£°æ˜å¸¸é‡ä½¿ç”¨ `const` å…³é”®å­—, ä»–çš„ç±»å‹å¿…é¡»è¢«æ ‡æ³¨
    - å¸¸é‡å¯ä»¥åœ¨ä»»æ„ä½œç”¨åŸŸå†…è¿›è¡Œå£°æ˜, åŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ
    - å¸¸é‡åªå¯ä»¥ç»‘å®šåˆ°å¸¸é‡è¡¨è¾¾å¼, æ— æ³•ç»‘å®šåˆ°å‡½æ•°çš„è°ƒç”¨ç»“æœæˆ–åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å¾—åˆ°çš„å€¼
- åœ¨ç¨‹åºè¿è¡ŒæœŸé—´, å¸¸é‡åœ¨å…¶å£°æ˜çš„ä½œç”¨åŸŸå†…ä¸€ç›´æœ‰æ•ˆ
- å‘½åè§„èŒƒ: **Rust**é‡Œçš„å¸¸é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯, å•è¯é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”. (ä¾‹: `const MAX_POINTS: u32 = 10_000;`)

```rust
fn var_and_const() {
    const MAX_POINTS: [i32; 2] = [0, 0];
    // const mut MAX_POINTS_MUT: [i32; 2] = [0, 0];  // error
}
```

> **é‡å½± _Shadowing_**

- å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡(æ–°çš„ç±»å‹ã€æ–°çš„å€¼), æ–°çš„å˜é‡ä¼šé‡å½±(`shadow`)ä¹‹å‰å£°æ˜çš„å˜é‡
- `shadow` å’ŒæŠŠå˜é‡æ ‡è®°ä¸º `mut`æ˜¯ä¸ä¸€æ ·çš„:
    - å¦‚æœä¸ä½¿ç”¨ `let` å…³é”®å­—, é‚£ä¹ˆé‡æ–°ç»™é `mut` çš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯
    - è€Œä½¿ç”¨ `let` å£°æ˜åŒåæ–°å˜é‡, ä¹Ÿæ˜¯ä¸å¯å˜çš„
    - ä½¿ç”¨ `let` å£°æ˜çš„æ–°å˜é‡, å¯ä»¥ä¸ºæ–°çš„ç±»å‹/æ–°çš„å€¼

```rust
fn shadow() {
    let what_type: u32 = 1;  // u32
    let what_type: &str = "1";  // &str
    let what_type: bool = false;  // bool
}
```

### æ•°æ®ç±»å‹

- æ ‡é‡å’Œå¤åˆç±»å‹
- **Rust**æ˜¯é™æ€ç¼–è¯‘è¯­è¨€, åœ¨ç¼–è¯‘æ—¶å¿…é¡»çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹
    - åŸºäºä½¿ç”¨çš„å€¼, ç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒçš„å…·ä½“ç±»å‹
    - ä½†å¦‚æœå¯èƒ½çš„ç±»å‹æ¯”è¾ƒå¤š(å¦‚ `String` çš„ `parse` æ–¹æ³•), å°±å¿…é¡»æ·»åŠ ç±»å‹æ ‡æ³¨, å¦åˆ™å°±ä¼šæŠ¥ç¼–è¯‘æ—¶é”™è¯¯

> **æ ‡é‡ç±»å‹**

- ä¸€ä¸ªæ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼
- **Rust**æœ‰å››ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹
    - æ•´æ•°ç±»å‹
    - æµ®ç‚¹ç±»å‹
    - å¸ƒå°”ç±»å‹
    - å­—ç¬¦ç±»å‹

> > **æ•´æ•°ç±»å‹**

- æ•´æ•°ç±»å‹æ²¡æœ‰å°æ•°éƒ¨åˆ†
- æ— ç¬¦å·ä»¥ `u` å¼€å¤´
- æœ‰ç¬¦å·ä»¥ `i` å¼€å¤´
- **Rust**çš„æ•´æ•°ç±»å‹åˆ—è¡¨å¦‚ä¸‹

| length | signed | unsigned |
| --- | --- | --- |
| 8-bit | i8 | u8 |
| 16-bit | i16 | u16 |
| 32-bit | i32 | u32 |
| 64-bit | i64 | u64 |
| 128-bit | i128 | u128 |
| arch | isize | usize |

- `izise` å’Œ `usize` ç±»å‹çš„ä½æ•°ç”±ç¨‹åºè¿è¡Œçš„è®¡ç®—æœºçš„æ¶æ„å†³å®š
    - å¦‚æœæ˜¯64ä½è®¡ç®—æœº, é‚£ä¹ˆå°±æ˜¯64ä½çš„
    - ä½¿ç”¨ `isize` æˆ– `usize` çš„ä¸»è¦åœºæ™¯æ˜¯å¯¹æŸç§é›†åˆè¿›è¡Œç´¢å¼•æ“ä½œ
- æ•´æ•°å­—é¢é‡
    - é™¤äº† `byte` ç±»å‹å¤–, æ‰€æœ‰çš„æ•°å€¼å­—é¢é‡éƒ½å…è®¸ä½¿ç”¨ç±»å‹åç¼€ `42u8`
    - å¦‚æœä¸æ¸…æ¥šè¯¥ä½¿ç”¨ä»€ä¹ˆç±»å‹, åˆ™å¯ä»¥ä½¿ç”¨ç›¸åº”çš„é»˜è®¤ç±»å‹
        - æ•´æ•°çš„é»˜è®¤ç±»å‹æ˜¯ `i32`

| è¿›åˆ¶ | ä¾‹å­ |
| --- | --- |
| Decimal | `10_000` |
| Hex | `0xff` |
| Octal | `0o77` |
| Binary | `0b11` |
| Byte(`u8` only) | `b'A'` |

- æ•´æ•°æº¢å‡º
    - è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘, **Rust** ä¼šæ£€æŸ¥æ•´æ•°æº¢å‡º, å¦‚æœå‘ç”Ÿæ•´æ•°æº¢å‡ºåˆ™ä¼šå¯¼è‡´ `panic`
    - å‘å¸ƒæ¨¡å¼(`--release`)ä¸‹ç¼–è¯‘, **Rust** ä¸ä¼šæ£€æŸ¥å¯èƒ½å¯¼è‡´ `panic` çš„æ•´æ•°æº¢å‡º
        - å¦‚æœæº¢å‡ºå‘ç”Ÿ, åˆ™ä¼šæ‰§è¡Œ _"ç¯ç»•"_ æ“ä½œ (ä¾‹: `u8` ç±»å‹çš„ `256` å˜æˆ `0`)

> > **æµ®ç‚¹ç±»å‹**

- æµ®ç‚¹ç±»å‹å«æœ‰å°æ•°éƒ¨åˆ†
- **Rust** æœ‰ä¸¤ç§åŸºç¡€çš„æµ®ç‚¹ç±»å‹
    - `f32` 32ä½, å•ç²¾åº¦
    - `f64` 64ä½, åŒç²¾åº¦
- **Rust** çš„æµ®ç‚¹ç±»å‹ä½¿ç”¨äº† `IEEE-754` æ ‡å‡†æ¥è¡¨è¿°
- `f64` æ˜¯é»˜è®¤ç±»å‹, å› ä¸ºç°ä»£CPUä¸Š `f64` å’Œ `f32` é€Ÿåº¦å·®ä¸å¤š, ä½†ç²¾åº¦æ›´é«˜
- æ•°å€¼æ“ä½œ

```rust
fn calculate() {
    let sum = 5 + 10;
    let difference = 95.5 - 33.2;
    let product = 4 * 30;
    let quotient = 5.67 / 3.22;
    let remainder = 51 % 4;
}
```

> > **å¸ƒå°”ç±»å‹**

- **Rust** çš„å¸ƒå°”ç±»å‹ä¹Ÿæœ‰ä¸¤ä¸ªå€¼: `true` å’Œ `false`
- å ç”¨ä¸€ä¸ªå­—èŠ‚å¤§å°
- ç¬¦å·ä¸º `bool`

> > **å­—ç¬¦ç±»å‹**

- **Rust** ä¸­çš„ `char` ç±»å‹è¢«ç”¨æ¥æè¿°å•ä¸ªå­—ç¬¦
- å­—ç¬¦ç±»å‹çš„å­—é¢é‡ä½¿ç”¨å•å¼•å· `'`
- å ç”¨4å­—èŠ‚å¤§å°
- æ˜¯ `Unicode` æ ‡é‡å€¼, å¯ä»¥è¡¨ç¤ºæ¯” `ASCII` å¤šå¾—å¤šçš„å­—ç¬¦å†…å®¹ (æ‹¼éŸ³ã€ä¸­æ—¥éŸ©æ–‡ã€emojiè¡¨æƒ…ç­‰)
    - èŒƒå›´ä¸º `U+0000` åˆ° `U+D7FF` å’Œ `U+E000` åˆ° `U+10FFFF`
- ä½† `Unicode` ä¸­æ²¡æœ‰ _å­—ç¬¦_ çš„æ¦‚å¿µ, æ‰€ä»¥ç›´è§‰ä¸Šçš„å­—ç¬¦ä¸ **Rust** ä¸­çš„å­—ç¬¦æ¦‚å¿µå¹¶ä¸ç›¸ç¬¦

```rust
fn character() {
    let x = 'x';
    let y: char = 'ãŠ';
    let z = 'ğŸ˜‚';
}
```

> **å¤åˆç±»å‹**

- å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- **Rust** æä¾›äº†ä¸¤ç§åŸºç¡€çš„å¤åˆç±»å‹: å…ƒç»„(`Tuple`) å’Œ æ•°ç»„(`Array`)

> > å…ƒç»„

- å…ƒç»„å¯ä»¥å°†å¤šä¸ªç±»å‹çš„å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹ä¸­
- å…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„, ä¸€æ—¦å£°æ˜å°±æ— æ³•æ”¹å˜

```rust
fn tuple_example() {
    // å£°æ˜
    let tup: (i32, f64, u8) = (-500, 6.4, 1);

    // è·å–å€¼
    let (x, y, z) = tup;
    println!("{}, {}, {}", x, y, z);  // -500, 6.4, 1

    // è®¿é—®
    println!("{}, {}, {}", tup.0, tup.1, tup.2);  // -500, 6.4, 1
}
```

> > æ•°ç»„

- æ•°ç»„ä¹Ÿå¯ä»¥å°†å¤šä¸ªç±»å‹çš„å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹ä¸­
- æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„, ä¸”å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒ
- æ•°ç»„çš„ç±»å‹ä»¥è¿™ç§å½¢å¼è¡¨ç¤º: `[type; length]`
- \* å¦‚æœæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½ç›¸åŒ, é‚£ä¹ˆ:
    - åœ¨ä¸­æ‹¬å·ä¸­æŒ‡å®šåˆå§‹å€¼
    - ä½¿ç”¨åˆ†å·åˆ†éš”
    - æœ€åå†™ä¸Šæ•°ç»„çš„é•¿åº¦
    - `let a = [3; 5];` ç­‰ä»·äº `let a = [3, 3, 3, 3, 3];`
- è®¿é—®æ•°ç»„å…ƒç´ : ä½¿ç”¨ç´¢å¼•è®¿é—®(ç´¢å¼•ä» `0` å¼€å§‹)
- å¦‚æœè®¿é—®çš„ç´¢å¼•è¶…å‡ºäº†æ•°ç»„çš„èŒƒå›´
    - ç¼–è¯‘å¯èƒ½ä¼šé€šè¿‡
    - è¿è¡Œä¼šæŠ¥é”™ (`panic`)
    - **Rust** ä¸å…è®¸å…¶è®¿é—®æ•°ç»„è¶Šç•Œåç›¸åº”åœ°å€çš„å†…å­˜ (ä¸ `c/c++` åŒºåˆ«)

```rust
fn array_example() {
    // å£°æ˜
    let a: [i32; 5] = [1, 2, 3, 4, 5];
    let b = [1; 5];

    // è®¿é—®
    println!("a[1]: {}", a[1]);
    println!("b[2]: {}", b[2]);

    // è¶Šç•Œ
    let names = ["name1", "name2", "name3"];
    let idx = [1, 2, 3, 4];
    println!("{}", names[4]);  // panic in compiling
    println!("{}", names[idx[3]]);  // runtime panic
}
```

### é”™è¯¯å¤„ç†

`unwrap` å’Œ `expect`

- `unwrap(self)`:
    - å¦‚æœæˆåŠŸ, åˆ™ç›´æ¥è¿”å› `Result::Ok` é‡Œçš„å€¼,
    - å¦‚æœå¤±è´¥, åˆ™è°ƒç”¨ `panic!` å®ä¸­æ­¢ç¨‹åº.
- `expect(self, msg: &str)`:
    - æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°(åˆ‡ç‰‡ç±»å‹), å½“ç»“æœä¸º`Result::Error`çš„æ—¶å€™è¾“å‡º.
    - å¦‚æœæˆåŠŸ, åˆ™ç›´æ¥è¿”å› `result` é‡Œçš„å€¼,
    - å¦‚æœå¤±è´¥, åˆ™è¾“å‡º`expect`çš„å…¥å‚å¹¶è°ƒç”¨ `panic!` å®ä¸­æ­¢ç¨‹åº.
- `result` çš„ç»“æ„å¦‚ä¸‹:

```rust
enum Result<T, E> {
    Ok(T),
    Error(E),
}
```